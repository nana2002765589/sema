---
const { pathname } = Astro.url;
const base = import.meta.env.BASE_URL;
const { showTabs = true } = Astro.props;

// Normalize pathname to remove trailing slash if it's not the root
const normalizedPathname = pathname.length > 1 && pathname.endsWith('/') ? pathname.slice(0, -1) : pathname;

const tabs = [
    { name: 'マンガ', href: base === '/' ? '/' : base },
    { name: 'アニメ', href: `${base}/anime` },
    { name: '解説', href: `${base}/explanation` },
    { name: '考察', href: `${base}/insights` }
]
---
{showTabs && (
    <div class="sub-header">
        <nav>
            {tabs.map(tab => {
                let isActive = false;
                const tabPath = tab.href;

                if (tab.name === '作品') {
                    const projectsRoot = base === '/' ? '/' : base;
                    // Active if it's the root page or a projects page, but not insights or explanation
                    isActive = (normalizedPathname === projectsRoot || normalizedPathname.startsWith(`${projectsRoot}/projects`)) && !normalizedPathname.startsWith(`${base}/insights`) && !normalizedPathname.startsWith(`${base}/explanation`);
                } else {
                    // Active if the path starts with the tab's href
                    isActive = normalizedPathname.startsWith(tabPath);
                }

                return (
                    <a href={tab.href} class:list={{ active: isActive }}>
                        {tab.name}
                    </a>
                );
            })}
        </nav>
    </div>
)}

<style>
    .sub-header {
        background-color: #ffffff;
        border-bottom: 1px solid #e7e7e7;
    }
    nav {
        display: flex;
        justify-content: center;
        gap: 2rem;
        max-width: 1200px;
        margin: 0 auto;
        flex-wrap: wrap;
    }
    a {
        padding: 1rem 0.5rem;
        text-decoration: none;
        color: #666;
        font-weight: 500;
        border-bottom: 2px solid transparent;
        transition: color 0.2s, border-color 0.2s;
    }
    a:hover {
        color: #000;
    }
    a.active {
        color: #000;
        border-bottom-color: #000;
    }

    @media (max-width: 768px) {
        nav {
            gap: 1rem;
            justify-content: center;
        }
        a {
            padding: 0.75rem 0.25rem;
        }
    }
</style>
